<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServicePro - Plataforma de Reserva de Servicios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #f59e0b;
            --accent-dark: #d97706;
            --light: #f8fafc;
            --light-gray: #e2e8f0;
            --dark: #1e293b;
            --darker: #0f172a;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --text: #334155;
            --text-light: #64748b;
            --border: #cbd5e1;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --light: #1e293b;
            --light-gray: #334155;
            --dark: #f8fafc;
            --darker: #e2e8f0;
            --text: #e2e8f0;
            --text-light: #94a3b8;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--text);
            min-height: 100vh;
            transition: var(--transition);
        }

        /* Header */
        .header {
            background: var(--light);
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background: none;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-role {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--error);
            color: var(--error);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: var(--error);
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .language-selector {
            position: relative;
        }

        .language-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 10px;
            display: none;
            z-index: 100;
            min-width: 120px;
        }

        .language-dropdown.active {
            display: block;
        }

        .language-option {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: var(--transition);
        }

        .language-option:hover {
            background: var(--light-gray);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(16, 185, 129, 0.8)),
                        var(--hero-image, url('https://images.unsplash.com/photo-1556761175-5973dc0f32e7?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80'));
            background-size: cover;
            background-position: center;
            padding: 120px 20px;
            text-align: center;
            color: white;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
        }

        .btn-secondary:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Features Section */
        .features {
            padding: 80px 20px;
            background: var(--light);
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
            font-size: 2.5rem;
            color: var(--dark);
        }

        .features-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
        }

        .feature-card {
            background: var(--light);
            padding: 40px 30px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
        }

        .feature-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .feature-description {
            color: var(--text-light);
            line-height: 1.6;
        }

        /* Services Preview */
        .services-preview {
            padding: 80px 20px;
            background: var(--light-gray);
        }

        .services-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .service-card {
            background: var(--light);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .service-image {
            width: 100%;
            height: 200px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            background-size: cover;
            background-position: center;
        }

        .service-info {
            padding: 25px;
        }

        .service-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .service-description {
            color: var(--text-light);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .service-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .service-features li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .service-features li i {
            color: var(--success);
        }

        /* Stats Section */
        .stats {
            padding: 80px 20px;
            background: var(--primary);
            color: white;
        }

        .stats-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* CTA Section */
        .cta {
            padding: 100px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
        }

        .cta h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .cta p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Footer */
        .footer {
            background: var(--darker);
            color: var(--text-light);
            padding: 60px 20px 30px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid var(--border);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--light);
            border-radius: var(--radius);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--dark);
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--error);
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--light);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .google-auth-btn {
            width: 100%;
            padding: 12px;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }

        .google-auth-btn:hover {
            background: var(--light-gray);
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border);
        }

        .divider span {
            background: var(--light);
            padding: 0 15px;
            color: var(--text-light);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        /* Dashboard */
        .dashboard {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 2rem;
            color: var(--dark);
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .stat-card.success {
            border-left-color: var(--success);
        }

        .stat-card.warning {
            border-left-color: var(--warning);
        }

        .stat-card.error {
            border-left-color: var(--error);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .dashboard-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Calendar */
        .calendar-container {
            background: var(--light);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav-btn {
            background: var(--light-gray);
            border: none;
            border-radius: var(--radius);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-nav-btn:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .calendar-day {
            background: var(--light);
            padding: 12px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
        }

        .calendar-day-header {
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .calendar-day.today {
            background: rgba(37, 99, 235, 0.1);
        }

        .calendar-day.other-month {
            color: var(--text-light);
            background: var(--light-gray);
        }

        .calendar-event {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-top: 5px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Tables */
        .admin-section {
            background: var(--light);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .admin-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .admin-table th,
        .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            background: var(--light-gray);
            font-weight: 600;
            color: var(--dark);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-confirmed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-completed {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn.edit {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .action-btn.view {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .action-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        /* VOIP Panel */
        .voip-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--light);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            width: 350px;
            overflow: hidden;
            display: none;
        }

        .voip-panel.active {
            display: block;
        }

        .voip-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .voip-body {
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .voip-contact {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .voip-contact:hover {
            background: var(--light-gray);
        }

        .voip-contact:last-child {
            border-bottom: none;
        }

        .voip-contact-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .voip-contact-info {
            flex: 1;
        }

        .voip-contact-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .voip-contact-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .voip-call-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            border-top: 1px solid var(--border);
        }

        .call-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .call-btn.call {
            background: var(--success);
            color: white;
        }

        .call-btn.hangup {
            background: var(--error);
            color: white;
        }

        .call-btn.message {
            background: var(--info);
            color: white;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .file-upload i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--text-light);
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .preview-item {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .preview-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Booking Modal */
        .booking-modal .modal-content {
            max-width: 800px;
        }

        .booking-steps {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border);
        }

        .booking-step {
            flex: 1;
            text-align: center;
            padding: 15px;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .booking-step.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .booking-step.completed {
            color: var(--success);
        }

        .booking-content {
            display: none;
        }

        .booking-content.active {
            display: block;
        }

        .service-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .service-option {
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .service-option:hover {
            border-color: var(--primary);
        }

        .service-option.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .service-option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .booking-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }

        /* Admin Panel */
        .admin-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: var(--light);
            border-right: 1px solid var(--border);
            transition: var(--transition);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .admin-panel.active {
            left: 0;
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1001;
            box-shadow: var(--shadow);
            display: none;
            transition: var(--transition);
        }

        .admin-toggle.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Master Config */
        .storage-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .storage-option {
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .storage-option:hover {
            border-color: var(--primary);
        }

        .storage-option.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .storage-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                gap: 15px;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .dashboard-tabs {
                overflow-x: auto;
            }

            .admin-panel {
                width: 100%;
                left: -100%;
            }

            .voip-panel {
                width: calc(100% - 40px);
            }

            .storage-options {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in {
            animation: slideIn 0.5s ease;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 4000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--error);
        }

        .notification.warning {
            background: var(--warning);
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Operación completada</span>
    </div>

    <!-- Header -->
    <header class="header" id="mainHeader">
        <div class="header-content">
            <a href="#" class="logo">
                <span class="logo-icon"><i class="fas fa-tools"></i></span>
                <span>ServicePro</span>
            </a>

            <div class="nav-links">
                <a class="nav-link" onclick="scrollToSection('services')" data-i18n="services">Servicios</a>
                <a class="nav-link" onclick="scrollToSection('features')" data-i18n="features">Características</a>
                <a class="nav-link" onclick="scrollToSection('about')" data-i18n="about">Nosotros</a>
                <a class="nav-link" onclick="scrollToSection('contact')" data-i18n="contact">Contacto</a>
            </div>

            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-outline" onclick="showLoginModal()" data-i18n="login">Iniciar Sesión</button>
                <button class="btn btn-primary" onclick="showRegisterModal()" data-i18n="register">Registrarse</button>
            </div>

            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userEmail">usuario@ejemplo.com</span>
                <span class="user-role" id="userRole">Usuario</span>
                
                <button class="action-btn" id="voipButton" onclick="toggleVoip()" title="Comunicaciones VOIP">
                    <i class="fas fa-phone-alt"></i>
                </button>
                
                <div class="language-selector">
                    <button class="language-btn" onclick="toggleLanguageDropdown()">
                        <i class="fas fa-globe"></i> <span id="currentLanguage">ES</span>
                    </button>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" onclick="changeLanguage('es')">Español</div>
                        <div class="language-option" onclick="changeLanguage('en')">English</div>
                    </div>
                </div>
                
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                
                <button class="logout-btn" onclick="logout()" data-i18n="logout">Cerrar Sesión</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="heroSection">
        <div class="hero-content fade-in">
            <h1 data-i18n="heroTitle">Servicios Profesionales para tu Hogar</h1>
            <p data-i18n="heroSubtitle">
                Reserva fácilmente servicios de reparación, mantenimiento e instalación con profesionales certificados. 
                Tu satisfacción es nuestra prioridad.
            </p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="showBookingModal()">
                    <i class="fas fa-calendar-plus"></i> <span data-i18n="bookNow">Reservar Ahora</span>
                </button>
                <button class="btn btn-secondary" onclick="scrollToSection('services')">
                    <i class="fas fa-concierge-bell"></i> <span data-i18n="viewServices">Ver Servicios</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="features">
        <div class="container">
            <h2 class="section-title" data-i18n="whyChooseUs">¿Por Qué Elegirnos?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3 class="feature-title" data-i18n="fastService">Servicio Rápido</h3>
                    <p class="feature-description" data-i18n="fastServiceDesc">
                        Respuesta inmediata y servicio eficiente. Nuestros técnicos llegan a tiempo y solucionan tu problema rápidamente.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="feature-title" data-i18n="qualityGuarantee">Garantía de Calidad</h3>
                    <p class="feature-description" data-i18n="qualityGuaranteeDesc">
                        Todos nuestros servicios incluyen garantía. Si no quedas satisfecho, volvemos gratis a solucionarlo.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3 class="feature-title" data-i18n="expertTechnicians">Técnicos Expertos</h3>
                    <p class="feature-description" data-i18n="expertTechniciansDesc">
                        Profesionales certificados con años de experiencia en reparaciones y mantenimiento de todo tipo.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Preview -->
    <section class="services-preview" id="services">
        <div class="container">
            <h2 class="section-title" data-i18n="ourServices">Nuestros Servicios</h2>
            <div class="services-grid" id="servicesGrid">
                <!-- Los servicios se cargan dinámicamente -->
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats" id="stats">
        <div class="stats-grid">
            <div class="stat">
                <div class="stat-number" id="completedJobs">2,500+</div>
                <div class="stat-label" data-i18n="jobsCompleted">Trabajos Completados</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="happyClients">1,200+</div>
                <div class="stat-label" data-i18n="happyClients">Clientes Satisfechos</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="expertTechnicians">50+</div>
                <div class="stat-label" data-i18n="expertTechnicians">Técnicos Expertos</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="serviceAreas">15+</div>
                <div class="stat-label" data-i18n="serviceAreas">Áreas de Servicio</div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta" id="cta">
        <h2 data-i18n="readyToGetStarted">¿Listo para comenzar?</h2>
        <p data-i18n="ctaDescription">
            Únete a miles de clientes satisfechos que confían en nosotros para sus necesidades de reparación y mantenimiento.
        </p>
        <button class="btn btn-secondary" onclick="showRegisterModal()">
            <i class="fas fa-user-plus"></i> <span data-i18n="getStarted">Comenzar Ahora</span>
        </button>
    </section>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3 data-i18n="servicePro">ServicePro</h3>
                <p data-i18n="footerDescription">
                    Tu socio confiable para todos los servicios de reparación y mantenimiento del hogar. Calidad, confianza y satisfacción garantizada.
                </p>
            </div>
            <div class="footer-section">
                <h3 data-i18n="quickLinks">Enlaces Rápidos</h3>
                <ul class="footer-links">
                    <li><a onclick="scrollToSection('services')" data-i18n="services">Servicios</a></li>
                    <li><a onclick="scrollToSection('features')" data-i18n="features">Características</a></li>
                    <li><a onclick="scrollToSection('about')" data-i18n="about">Nosotros</a></li>
                    <li><a onclick="scrollToSection('contact')" data-i18n="contact">Contacto</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3 data-i18n="contactUs">Contáctanos</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-phone"></i> +1 (555) 123-4567</li>
                    <li><i class="fas fa-envelope"></i> info@servicepro.com</li>
                    <li><i class="fas fa-map-marker-alt"></i> <span data-i18n="address">123 Calle Principal, Ciudad</span></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 ServicePro. <span data-i18n="allRightsReserved">Todos los derechos reservados.</span></p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="login">Iniciar Sesión</h3>
                <button class="close-modal" onclick="closeLoginModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="google-auth-container"></div>
                
                <div class="divider">
                    <span data-i18n="or">O</span>
                </div>

                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" data-i18n="email">Correo Electrónico</label>
                        <input type="email" class="form-control" id="loginEmail" required data-i18n-placeholder="enterEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="password">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" required data-i18n-placeholder="enterPassword">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> <span data-i18n="login">Iniciar Sesión</span>
                    </button>
                </form>

                <div class="auth-switch">
                    <span data-i18n="noAccount">¿No tienes cuenta?</span>
                    <a onclick="showRegisterModal()" data-i18n="registerHere">Regístrate aquí</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="createAccount">Crear Cuenta</h3>
                <button class="close-modal" onclick="closeRegisterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="google-register-container"></div>
                
                <div class="divider">
                    <span data-i18n="or">O</span>
                </div>

                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" data-i18n="fullName">Nombre Completo</label>
                        <input type="text" class="form-control" id="registerName" required data-i18n-placeholder="enterFullName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="email">Correo Electrónico</label>
                        <input type="email" class="form-control" id="registerEmail" required data-i18n-placeholder="enterEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="phone">Teléfono</label>
                        <input type="tel" class="form-control" id="registerPhone" data-i18n-placeholder="enterPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="password">Contraseña</label>
                        <input type="password" class="form-control" id="registerPassword" required data-i18n-placeholder="enterPassword">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="confirmPassword">Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" required data-i18n-placeholder="confirmPassword">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> <span data-i18n="createAccount">Crear Cuenta</span>
                    </button>
                </form>

                <div class="auth-switch">
                    <span data-i18n="haveAccount">¿Ya tienes cuenta?</span>
                    <a onclick="showLoginModal()" data-i18n="loginHere">Inicia sesión aquí</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal booking-modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="bookService">Reservar Servicio</h3>
                <button class="close-modal" onclick="closeBookingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="booking-steps">
                    <div class="booking-step active" id="step1Indicator">1</div>
                    <div class="booking-step" id="step2Indicator">2</div>
                    <div class="booking-step" id="step3Indicator">3</div>
                    <div class="booking-step" id="step4Indicator">4</div>
                </div>

                <div class="booking-content active" id="step1">
                    <h4 data-i18n="selectService">Selecciona un Servicio</h4>
                    <div class="service-options" id="serviceOptions">
                        <!-- Las opciones de servicio se cargan dinámicamente -->
                    </div>
                </div>

                <div class="booking-content" id="step2">
                    <h4 data-i18n="serviceDetails">Detalles del Servicio</h4>
                    <div class="form-group">
                        <label class="form-label" data-i18n="selectedService">Servicio Seleccionado</label>
                        <div class="form-control" id="selectedServiceName" style="background: var(--light-gray);">-</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="problemDescription">Descripción del Problema</label>
                        <textarea class="form-control form-textarea" id="problemDescription" data-i18n-placeholder="describeProblem"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="uploadPhotos">Subir Fotos (Opcional)</label>
                        <div class="file-upload" onclick="document.getElementById('servicePhotos').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p data-i18n="uploadHint">Haz clic para subir fotos o arrástralas aquí</p>
                            <input type="file" id="servicePhotos" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                        </div>
                        <div class="image-preview" id="imagePreview"></div>
                    </div>
                </div>

                <div class="booking-content" id="step3">
                    <h4 data-i18n="scheduleAppointment">Programar Cita</h4>
                    <div class="form-group">
                        <label class="form-label" data-i18n="preferredDate">Fecha Preferida</label>
                        <input type="date" class="form-control" id="preferredDate" min="">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="preferredTime">Hora Preferida</label>
                        <select class="form-control" id="preferredTime">
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">01:00 PM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="serviceAddress">Dirección del Servicio</label>
                        <textarea class="form-control form-textarea" id="serviceAddress" data-i18n-placeholder="enterServiceAddress"></textarea>
                    </div>
                </div>

                <div class="booking-content" id="step4">
                    <h4 data-i18n="confirmation">Confirmación</h4>
                    <div class="form-group">
                        <div style="background: var(--light-gray); padding: 20px; border-radius: var(--radius);">
                            <h5 data-i18n="bookingSummary">Resumen de la Reserva</h5>
                            <p><strong data-i18n="service">Servicio:</strong> <span id="summaryService">-</span></p>
                            <p><strong data-i18n="date">Fecha:</strong> <span id="summaryDate">-</span></p>
                            <p><strong data-i18n="time">Hora:</strong> <span id="summaryTime">-</span></p>
                            <p><strong data-i18n="address">Dirección:</strong> <span id="summaryAddress">-</span></p>
                            <p><strong data-i18n="problem">Problema:</strong> <span id="summaryProblem">-</span></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="termsAgreement"> 
                            <span data-i18n="agreeTerms">Acepto los términos y condiciones del servicio</span>
                        </label>
                    </div>
                </div>

                <div class="booking-footer">
                    <button class="btn btn-outline" id="prevBtn" onclick="prevBookingStep()" style="display: none;" data-i18n="previous">Anterior</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextBookingStep()" data-i18n="next">Siguiente</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <section class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <h2 class="dashboard-title" data-i18n="dashboard">Panel de Control</h2>
            <div class="dashboard-actions">
                <button class="btn btn-primary" onclick="showBookingModal()" id="newBookingBtn" style="display: none;">
                    <i class="fas fa-plus"></i> <span data-i18n="newBooking">Nueva Reserva</span>
                </button>
            </div>
        </div>

        <div class="dashboard-cards">
            <div class="stat-card">
                <div class="stat-value" id="totalBookings">0</div>
                <div class="stat-label" data-i18n="totalBookings">Total Reservas</div>
            </div>
            <div class="stat-card success">
                <div class="stat-value" id="confirmedBookings">0</div>
                <div class="stat-label" data-i18n="confirmed">Confirmadas</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-value" id="pendingBookings">0</div>
                <div class="stat-label" data-i18n="pending">Pendientes</div>
            </div>
            <div class="stat-card error">
                <div class="stat-value" id="cancelledBookings">0</div>
                <div class="stat-label" data-i18n="cancelled">Canceladas</div>
            </div>
        </div>

        <div class="dashboard-tabs">
            <button class="tab-btn active" onclick="switchTab('calendar')" data-i18n="calendar">Calendario</button>
            <button class="tab-btn" onclick="switchTab('bookings')" data-i18n="bookings">Reservas</button>
            <button class="tab-btn" onclick="switchTab('customers')" data-i18n="customers">Clientes</button>
            <button class="tab-btn" onclick="switchTab('services')" id="servicesTabBtn" data-i18n="services">Servicios</button>
            <button class="tab-btn" onclick="switchTab('users')" id="usersTabBtn" data-i18n="users">Usuarios</button>
        </div>

        <div class="tab-content active" id="calendarTab">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 id="currentMonth">Enero 2024</h3>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- El calendario se genera dinámicamente -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="bookingsTab">
            <div class="admin-section">
                <h3 data-i18n="recentBookings">Reservas Recientes</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th data-i18n="id">ID</th>
                            <th data-i18n="customer">Cliente</th>
                            <th data-i18n="service">Servicio</th>
                            <th data-i18n="date">Fecha</th>
                            <th data-i18n="status">Estado</th>
                            <th data-i18n="actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTable">
                        <!-- Las reservas se cargan dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="customersTab">
            <div class="admin-section">
                <h3 data-i18n="customers">Clientes</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th data-i18n="name">Nombre</th>
                            <th data-i18n="email">Email</th>
                            <th data-i18n="phone">Teléfono</th>
                            <th data-i18n="bookings">Reservas</th>
                            <th data-i18n="actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="customersTable">
                        <!-- Los clientes se cargan dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="servicesTab">
            <div class="admin-section">
                <h3 data-i18n="servicesManagement">Gestión de Servicios</h3>
                <button class="btn btn-primary" onclick="showServiceEditor()" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> <span data-i18n="addService">Agregar Servicio</span>
                </button>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th data-i18n="service">Servicio</th>
                            <th data-i18n="category">Categoría</th>
                            <th data-i18n="price">Precio</th>
                            <th data-i18n="duration">Duración</th>
                            <th data-i18n="actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="servicesTable">
                        <!-- Los servicios se cargan dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="usersTab">
            <div class="admin-section">
                <h3 data-i18n="userManagement">Gestión de Usuarios</h3>
                <button class="btn btn-primary" onclick="showUserEditor()" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> <span data-i18n="addUser">Agregar Usuario</span>
                </button>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th data-i18n="name">Nombre</th>
                            <th data-i18n="email">Email</th>
                            <th data-i18n="role">Rol</th>
                            <th data-i18n="status">Estado</th>
                            <th data-i18n="actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <!-- Los usuarios se cargan dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Admin Panel -->
    <button class="admin-toggle" id="adminToggle" onclick="toggleAdminPanel()">
        <i class="fas fa-cog"></i>
    </button>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-section">
            <h3 data-i18n="systemConfig">Configuración del Sistema</h3>
            <div class="form-group">
                <label class="form-label" data-i18n="companyName">Nombre de la Empresa</label>
                <input type="text" class="form-control" id="companyName" value="ServicePro">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="primaryColor">Color Primario</label>
                <input type="color" class="form-control" id="primaryColor" value="#2563eb">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="secondaryColor">Color Secundario</label>
                <input type="color" class="form-control" id="secondaryColor" value="#10b981">
            </div>
            <button class="btn btn-primary" onclick="saveSystemConfig()" style="width: 100%;" data-i18n="saveConfig">Guardar Configuración</button>
        </div>

        <div class="admin-section" id="masterConfigSection" style="display: none;">
            <h3 data-i18n="dataStorage">Almacenamiento de Datos</h3>
            <div class="storage-options">
                <div class="storage-option" onclick="selectStorage('local')" id="localStorageOption">
                    <div class="storage-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h4>LocalStorage</h4>
                    <p data-i18n="localStorageDesc">Almacenamiento local en el navegador</p>
                </div>
                <div class="storage-option" onclick="selectStorage('api')" id="apiStorageOption">
                    <div class="storage-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <h4>API REST</h4>
                    <p data-i18n="apiStorageDesc">Conexión con servidor externo</p>
                </div>
            </div>

            <div id="apiConfig" style="display: none;">
                <div class="form-group">
                    <label class="form-label">URL Base de API</label>
                    <input type="text" class="form-control" id="apiBaseUrl" placeholder="https://api.servicepro.com">
                </div>
                <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" class="form-control" id="apiKey" placeholder="Tu API Key">
                </div>
            </div>

            <div id="d1Config" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Database ID</label>
                    <input type="text" class="form-control" id="d1DatabaseId" placeholder="ID de la base de datos D1">
                </div>
                <div class="form-group">
                    <label class="form-label">API Token</label>
                    <input type="password" class="form-control" id="d1ApiToken" placeholder="Token de API de Cloudflare">
                </div>
            </div>

            <button class="btn btn-primary" onclick="saveStorageConfig()" style="width: 100%; margin-top: 15px;" data-i18n="saveConfig">Guardar Configuración</button>
        </div>

        <div class="admin-section">
            <h3 data-i18n="voipConfig">Configuración VOIP</h3>
            <div class="form-group">
                <label class="form-label">Twilio Account SID</label>
                <input type="text" class="form-control" id="twilioSID" placeholder="AC...">
            </div>
            <div class="form-group">
                <label class="form-label">Twilio Auth Token</label>
                <input type="password" class="form-control" id="twilioToken" placeholder="...">
            </div>
            <div class="form-group">
                <label class="form-label">Número de Teléfono Twilio</label>
                <input type="text" class="form-control" id="twilioPhone" placeholder="+1234567890">
            </div>
            <button class="btn btn-primary" onclick="saveVoipConfig()" style="width: 100%;" data-i18n="saveConfig">Guardar Configuración</button>
        </div>
    </div>

    <!-- VOIP Panel -->
    <div class="voip-panel" id="voipPanel">
        <div class="voip-header">
            <h4 data-i18n="communications">Comunicaciones</h4>
            <button class="close-modal" onclick="toggleVoip()" style="color: white;">&times;</button>
        </div>
        <div class="voip-body">
            <div class="voip-contact" onclick="startCall('Juan Pérez', 'customer')">
                <div class="voip-contact-avatar">JP</div>
                <div class="voip-contact-info">
                    <div class="voip-contact-name">Juan Pérez</div>
                    <div class="voip-contact-role" data-i18n="customer">Cliente - Reparación de Lavadora</div>
                </div>
            </div>
            <div class="voip-contact" onclick="startCall('María García', 'customer')">
                <div class="voip-contact-avatar">MG</div>
                <div class="voip-contact-info">
                    <div class="voip-contact-name">María García</div>
                    <div class="voip-contact-role" data-i18n="customer">Cliente - Instalación de Aire Acondicionado</div>
                </div>
            </div>
            <div class="voip-contact" onclick="startCall('Carlos López', 'employee')">
                <div class="voip-contact-avatar">CL</div>
                <div class="voip-contact-info">
                    <div class="voip-contact-name">Carlos López</div>
                    <div class="voip-contact-role" data-i18n="technician">Técnico - Zona Norte</div>
                </div>
            </div>
            <div class="voip-contact" onclick="startCall('Ana Martínez', 'employee')">
                <div class="voip-contact-avatar">AM</div>
                <div class="voip-contact-info">
                    <div class="voip-contact-name">Ana Martínez</div>
                    <div class="voip-contact-role" data-i18n="technician">Técnica - Zona Sur</div>
                </div>
            </div>
        </div>
        <div class="voip-call-controls" id="callControls" style="display: none;">
            <button class="call-btn message" onclick="sendMessage()" title="Enviar mensaje">
                <i class="fas fa-sms"></i>
            </button>
            <button class="call-btn call" onclick="makeCall()" title="Llamar">
                <i class="fas fa-phone"></i>
            </button>
            <button class="call-btn hangup" onclick="endCall()" title="Colgar">
                <i class="fas fa-phone-slash"></i>
            </button>
        </div>
    </div>

    <!-- Service Editor Modal -->
    <div class="modal" id="serviceEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="serviceEditorTitle" data-i18n="addService">Agregar Servicio</h3>
                <button class="close-modal" onclick="closeServiceEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <div class="form-group">
                        <label class="form-label" data-i18n="serviceName">Nombre del Servicio</label>
                        <input type="text" class="form-control" id="serviceName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="category">Categoría</label>
                        <select class="form-control" id="serviceCategory" required>
                            <option value="appliance" data-i18n="applianceRepair">Reparación de Electrodomésticos</option>
                            <option value="handyman" data-i18n="handymanServices">Servicios de Handyman</option>
                            <option value="plumbing" data-i18n="plumbing">Fontanería</option>
                            <option value="painting" data-i18n="painting">Pintura</option>
                            <option value="flooring" data-i18n="flooring">Suelos</option>
                            <option value="carpentry" data-i18n="carpentry">Carpintería</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="description">Descripción</label>
                        <textarea class="form-control form-textarea" id="serviceDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="price">Precio ($)</label>
                        <input type="number" class="form-control" id="servicePrice" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="duration">Duración (minutos)</label>
                        <input type="number" class="form-control" id="serviceDuration" min="15" step="15" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="serviceIcon">Icono del Servicio</label>
                        <select class="form-control" id="serviceIcon">
                            <option value="fas fa-washing-machine">Lavadora</option>
                            <option value="fas fa-tint">Secadora</option>
                            <option value="fas fa-snowflake">Nevera</option>
                            <option value="fas fa-tools">Herramientas</option>
                            <option value="fas fa-key">Cerraduras</option>
                            <option value="fas fa-toilet">Inodoro</option>
                            <option value="fas fa-paint-roller">Pintura</option>
                            <option value="fas fa-border-all">Suelos</option>
                            <option value="fas fa-tree">Carpintería</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="serviceImage">Imagen del Servicio</label>
                        <div class="file-upload" onclick="document.getElementById('serviceImageUpload').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p data-i18n="uploadImageHint">Haz clic para subir una imagen</p>
                            <input type="file" id="serviceImageUpload" accept="image/*" style="display: none;" onchange="handleServiceImageUpload(this)">
                        </div>
                        <div class="image-preview" id="serviceImagePreview"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="features">Características</label>
                        <div id="serviceFeatures">
                            <div class="form-group" style="margin-bottom: 10px;">
                                <input type="text" class="form-control" placeholder="Característica 1">
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addFeatureField()" style="width: 100%;">
                            <i class="fas fa-plus"></i> <span data-i18n="addFeature">Agregar Característica</span>
                        </button>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> <span data-i18n="saveService">Guardar Servicio</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Editor Modal -->
    <div class="modal" id="userEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="userEditorTitle" data-i18n="addUser">Agregar Usuario</h3>
                <button class="close-modal" onclick="closeUserEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label class="form-label" data-i18n="fullName">Nombre Completo</label>
                        <input type="text" class="form-control" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="email">Correo Electrónico</label>
                        <input type="email" class="form-control" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="phone">Teléfono</label>
                        <input type="tel" class="form-control" id="userPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="role">Rol</label>
                        <select class="form-control" id="userRole" required>
                            <option value="user" data-i18n="user">Usuario</option>
                            <option value="employee" data-i18n="employee">Empleado</option>
                            <option value="admin" data-i18n="admin">Administrador</option>
                            <option value="master" data-i18n="master">Master</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="password">Contraseña</label>
                        <input type="password" class="form-control" id="userPassword">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="confirmPassword">Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="userConfirmPassword">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> <span data-i18n="saveUser">Guardar Usuario</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE PERSISTENCIA
        // =============================================
        class DataManager {
            constructor() {
                this.storageType = 'local'; // local, api, d1
                this.apiConfig = null;
                this.d1Config = null;
                this.init();
            }

            async init() {
                const config = this.loadConfig();
                this.storageType = config.storageType || 'local';
                this.apiConfig = config.apiConfig;
                this.d1Config = config.d1Config;
                
                if (this.storageType === 'api' && this.apiConfig) {
                    await this.testApiConnection();
                } else if (this.storageType === 'd1' && this.d1Config) {
                    await this.testD1Connection();
                }
            }

            loadConfig() {
                return JSON.parse(localStorage.getItem('servicepro_storage_config') || '{}');
            }

            saveConfig(config) {
                localStorage.setItem('servicepro_storage_config', JSON.stringify(config));
            }

            async testApiConnection() {
                try {
                    const response = await fetch(`${this.apiConfig.baseUrl}/health`, {
                        headers: {
                            'Authorization': `Bearer ${this.apiConfig.apiKey}`
                        }
                    });
                    return response.ok;
                } catch (error) {
                    console.error('Error testing API connection:', error);
                    return false;
                }
            }

            async testD1Connection() {
                // Implementar prueba de conexión a D1
                return true;
            }

            async saveData(key, data) {
                if (this.storageType === 'local') {
                    localStorage.setItem(`servicepro_${key}`, JSON.stringify(data));
                    return true;
                } else if (this.storageType === 'api') {
                    return await this.saveToApi(key, data);
                } else if (this.storageType === 'd1') {
                    return await this.saveToD1(key, data);
                }
            }

            async loadData(key) {
                if (this.storageType === 'local') {
                    return JSON.parse(localStorage.getItem(`servicepro_${key}`) || 'null');
                } else if (this.storageType === 'api') {
                    return await this.loadFromApi(key);
                } else if (this.storageType === 'd1') {
                    return await this.loadFromD1(key);
                }
            }

            async saveToApi(key, data) {
                try {
                    const response = await fetch(`${this.apiConfig.baseUrl}/data/${key}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiConfig.apiKey}`
                        },
                        body: JSON.stringify(data)
                    });
                    return response.ok;
                } catch (error) {
                    console.error('Error saving to API:', error);
                    return false;
                }
            }

            async loadFromApi(key) {
                try {
                    const response = await fetch(`${this.apiConfig.baseUrl}/data/${key}`, {
                        headers: {
                            'Authorization': `Bearer ${this.apiConfig.apiKey}`
                        }
                    });
                    if (response.ok) {
                        return await response.json();
                    }
                    return null;
                } catch (error) {
                    console.error('Error loading from API:', error);
                    return null;
                }
            }

            async saveToD1(key, data) {
                // Implementar guardado en D1
                return true;
            }

            async loadFromD1(key) {
                // Implementar carga desde D1
                return null;
            }
        }

        // =============================================
        // SISTEMA DE BASE DE DATOS
        // =============================================
        class Database {
            constructor() {
                this.dataManager = new DataManager();
                this.data = this.getDefaultData();
                this.init();
            }

            getDefaultData() {
                return {
                    users: [
                        {
                            id: 1,
                            name: "Master Admin",
                            email: "master@servicepro.com",
                            password: "master2025",
                            role: "master",
                            phone: "+1234567890",
                            status: "active",
                            emailVerified: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 2,
                            name: "David Admin",
                            email: "david@servicepro.com",
                            password: "david2025",
                            role: "admin",
                            phone: "+1234567891",
                            status: "active",
                            emailVerified: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 3,
                            name: "Técnico Juan",
                            email: "juan@servicepro.com",
                            password: "juan2025",
                            role: "employee",
                            phone: "+1234567892",
                            status: "active",
                            emailVerified: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 4,
                            name: "Cliente Ejemplo",
                            email: "cliente@servicepro.com",
                            password: "cliente2025",
                            role: "user",
                            phone: "+1234567893",
                            status: "active",
                            emailVerified: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }
                    ],
                    services: [
                        {
                            id: 1,
                            name: "Reparación de Lavadoras",
                            category: "appliance",
                            description: "Reparación profesional de lavadoras de todas las marcas y modelos",
                            price: 75.00,
                            duration: 120,
                            icon: "fas fa-washing-machine",
                            image: "",
                            features: [
                                "Diagnóstico gratuito",
                                "Reparación en el lugar",
                                "Garantía de 90 días",
                                "Piezas originales",
                                "Técnicos certificados"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 2,
                            name: "Reparación de Secadoras",
                            category: "appliance",
                            description: "Reparación de secadoras eléctricas y a gas de todas las marcas",
                            price: 70.00,
                            duration: 120,
                            icon: "fas fa-tint",
                            image: "",
                            features: [
                                "Diagnóstico gratuito",
                                "Reparación en el lugar",
                                "Garantía de 90 días",
                                "Limpieza incluida",
                                "Técnicos especializados"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 3,
                            name: "Reparación de Neveras",
                            category: "appliance",
                            description: "Reparación completa de refrigeradores y congeladores",
                            price: 85.00,
                            duration: 150,
                            icon: "fas fa-snowflake",
                            image: "",
                            features: [
                                "Diagnóstico gratuito",
                                "Reparación de fugas",
                                "Cambio de compresor",
                                "Limpieza del sistema",
                                "Garantía de 6 meses"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 4,
                            name: "Servicios de Handyman",
                            category: "handyman",
                            description: "Reparaciones generales y mantenimiento del hogar",
                            price: 65.00,
                            duration: 120,
                            icon: "fas fa-tools",
                            image: "",
                            features: [
                                "Multitud de servicios",
                                "Profesionales certificados",
                                "Materiales incluidos",
                                "Garantía de trabajo",
                                "Servicio rápido"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 5,
                            name: "Reparación de Cerraduras",
                            category: "handyman",
                            description: "Reparación e instalación de cerraduras y sistemas de seguridad",
                            price: 55.00,
                            duration: 60,
                            icon: "fas fa-key",
                            image: "",
                            features: [
                                "Servicio de emergencia",
                                "Cerraduras de todas las marcas",
                                "Instalación profesional",
                                "Llaves de repuesto",
                                "Garantía de funcionamiento"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 6,
                            name: "Instalación de Inodoros",
                            category: "plumbing",
                            description: "Instalación y reemplazo profesional de inodoros",
                            price: 120.00,
                            duration: 120,
                            icon: "fas fa-toilet",
                            image: "",
                            features: [
                                "Instalación profesional",
                                "Pruebas de fugas",
                                "Limpieza posterior",
                                "Materiales de calidad",
                                "Garantía de instalación"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 7,
                            name: "Pintura de Interiores",
                            category: "painting",
                            description: "Servicio profesional de pintura para interiores",
                            price: 200.00,
                            duration: 240,
                            icon: "fas fa-paint-roller",
                            image: "",
                            features: [
                                "Preparación de superficies",
                                "Pintura de calidad",
                                "Limpieza posterior",
                                "Protección de muebles",
                                "Resultado profesional"
                            ],
                            status: "active",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }
                    ],
                    bookings: [],
                    customers: [],
                    config: {
                        company_name: "ServicePro",
                        primary_color: "#2563eb",
                        secondary_color: "#10b981",
                        language: "es",
                        theme: "light",
                        voip_twilio_sid: "",
                        voip_twilio_token: "",
                        voip_twilio_phone: "",
                        email_smtp_host: "",
                        email_smtp_port: "",
                        email_smtp_user: "",
                        email_smtp_pass: ""
                    },
                    last_updated: new Date().toISOString()
                };
            }

            async init() {
                await this.dataManager.init();
                const savedData = await this.dataManager.loadData('database');
                if (savedData) {
                    this.data = { ...this.data, ...savedData };
                } else {
                    await this.save();
                }
            }

            async save() {
                this.data.last_updated = new Date().toISOString();
                return await this.dataManager.saveData('database', this.data);
            }

            // ========== USUARIOS ==========
            async createUser(user) {
                user.id = Date.now();
                user.createdAt = new Date().toISOString();
                user.updatedAt = new Date().toISOString();
                user.status = 'active';
                user.emailVerified = false;
                
                this.data.users.push(user);
                await this.save();
                return user;
            }

            getUserByEmail(email) {
                return this.data.users.find(user => user.email === email) || null;
            }

            getUserById(id) {
                return this.data.users.find(user => user.id === id) || null;
            }

            getUsers() {
                return this.data.users;
            }

            async updateUser(id, updates) {
                const index = this.data.users.findIndex(u => u.id === id);
                if (index !== -1) {
                    updates.updatedAt = new Date().toISOString();
                    this.data.users[index] = { ...this.data.users[index], ...updates };
                    await this.save();
                    return true;
                }
                return false;
            }

            async deleteUser(id) {
                this.data.users = this.data.users.filter(u => u.id !== id);
                await this.save();
                return true;
            }

            // ========== SERVICIOS ==========
            getServices() {
                return this.data.services;
            }

            getServiceById(id) {
                return this.data.services.find(service => service.id === id) || null;
            }

            getServicesByCategory(category) {
                return this.data.services.filter(service => service.category === category && service.status === 'active');
            }

            async createService(service) {
                service.id = Date.now();
                service.createdAt = new Date().toISOString();
                service.updatedAt = new Date().toISOString();
                service.status = 'active';
                
                this.data.services.push(service);
                await this.save();
                return service;
            }

            async updateService(id, updates) {
                const index = this.data.services.findIndex(s => s.id === id);
                if (index !== -1) {
                    updates.updatedAt = new Date().toISOString();
                    this.data.services[index] = { ...this.data.services[index], ...updates };
                    await this.save();
                    return true;
                }
                return false;
            }

            async deleteService(id) {
                this.data.services = this.data.services.filter(s => s.id !== id);
                await this.save();
                return true;
            }

            // ========== RESERVAS ==========
            async createBooking(booking) {
                booking.id = Date.now();
                booking.createdAt = new Date().toISOString();
                booking.updatedAt = new Date().toISOString();
                booking.status = 'pending';
                
                this.data.bookings.push(booking);
                
                // Agregar/actualizar cliente
                const existingCustomer = this.data.customers.find(c => c.email === booking.customerEmail);
                if (existingCustomer) {
                    existingCustomer.updatedAt = new Date().toISOString();
                } else {
                    this.data.customers.push({
                        id: Date.now(),
                        name: booking.customerName,
                        email: booking.customerEmail,
                        phone: booking.customerPhone,
                        address: booking.customerAddress,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                }
                
                await this.save();
                
                // Enviar email de confirmación
                this.sendBookingConfirmation(booking);
                
                return booking;
            }

            getBookings() {
                return this.data.bookings;
            }

            getBookingsByStatus(status) {
                return this.data.bookings.filter(booking => booking.status === status);
            }

            async updateBooking(id, updates) {
                const index = this.data.bookings.findIndex(b => b.id === id);
                if (index !== -1) {
                    updates.updatedAt = new Date().toISOString();
                    this.data.bookings[index] = { ...this.data.bookings[index], ...updates };
                    await this.save();
                    return true;
                }
                return false;
            }

            // ========== CONFIGURACIÓN ==========
            getConfig() {
                return this.data.config;
            }

            async updateConfig(key, value) {
                this.data.config[key] = value;
                await this.save();
                return true;
            }

            // ========== EMAIL ==========
            async sendBookingConfirmation(booking) {
                const service = this.getServiceById(booking.serviceId);
                const subject = `Confirmación de Reserva #${booking.id}`;
                const body = `
                    Hola ${booking.customerName},
                    
                    Tu reserva ha sido confirmada:
                    
                    Servicio: ${service.name}
                    Fecha: ${new Date(booking.date).toLocaleDateString()}
                    Hora: ${new Date(booking.date).toLocaleTimeString()}
                    Dirección: ${booking.customerAddress}
                    
                    Total: $${service.price}
                    
                    Nos pondremos en contacto contigo pronto para confirmar los detalles.
                    
                    Gracias por elegir ServicePro!
                `;
                
                // Aquí se integraría con un servicio de email
                console.log('Email enviado:', subject, body);
            }

            async sendEmailVerification(user) {
                const verificationCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                user.verificationCode = verificationCode;
                await this.updateUser(user.id, user);
                
                const subject = 'Verifica tu cuenta en ServicePro';
                const body = `
                    Hola ${user.name},
                    
                    Usa el siguiente código para verificar tu cuenta:
                    
                    Código: ${verificationCode}
                    
                    O haz clic en el siguiente enlace:
                    ${window.location.origin}/verify?code=${verificationCode}&email=${user.email}
                    
                    Este código expira en 24 horas.
                    
                    Gracias,
                    El equipo de ServicePro
                `;
                
                // Aquí se integraría con un servicio de email
                console.log('Email de verificación enviado:', subject, body);
            }
        }

        // =============================================
        // SISTEMA DE AUTENTICACIÓN
        // =============================================
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.db = new Database();
                this.init();
            }

            async init() {
                await this.db.init();
                this.checkAuth();
            }

            checkAuth() {
                const savedUser = localStorage.getItem('servicepro_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.handleAuthSuccess();
                }
            }

            async login(email, password) {
                const user = this.db.getUserByEmail(email);
                
                if (user && user.password === password && user.status === 'active') {
                    if (!user.emailVerified) {
                        await this.db.sendEmailVerification(user);
                        this.showNotification('Por favor verifica tu email. Se ha enviado un código de verificación.', 'warning');
                        this.showVerificationModal(user);
                        return false;
                    }
                    
                    this.currentUser = {
                        id: user.id,
                        email: user.email,
                        role: user.role,
                        name: user.name,
                        phone: user.phone,
                        loginTime: new Date().toISOString()
                    };

                    localStorage.setItem('servicepro_user', JSON.stringify(this.currentUser));
                    this.handleAuthSuccess();
                    this.showNotification('Inicio de sesión exitoso', 'success');
                    return true;
                } else {
                    this.showNotification('Credenciales incorrectas o cuenta inactiva', 'error');
                    return false;
                }
            }

            async loginWithGoogle(googleUser) {
                const profile = googleUser.getBasicProfile();
                const email = profile.getEmail();
                const name = profile.getName();
                
                let user = this.db.getUserByEmail(email);
                
                if (!user) {
                    // Crear nuevo usuario
                    user = await this.db.createUser({
                        name: name,
                        email: email,
                        password: '', // No password for Google users
                        role: 'user',
                        emailVerified: true
                    });
                }
                
                this.currentUser = {
                    id: user.id,
                    email: user.email,
                    role: user.role,
                    name: user.name,
                    loginTime: new Date().toISOString()
                };

                localStorage.setItem('servicepro_user', JSON.stringify(this.currentUser));
                this.handleAuthSuccess();
                this.showNotification('Inicio de sesión con Google exitoso', 'success');
            }

            async register(userData) {
                const existingUser = this.db.getUserByEmail(userData.email);
                if (existingUser) {
                    this.showNotification('Este email ya está registrado', 'error');
                    return false;
                }

                const user = await this.db.createUser({
                    name: userData.name,
                    email: userData.email,
                    password: userData.password,
                    role: 'user',
                    phone: userData.phone
                });

                await this.db.sendEmailVerification(user);
                this.showNotification('Cuenta creada. Por favor verifica tu email.', 'success');
                this.showVerificationModal(user);
                return true;
            }

            async verifyEmail(email, code) {
                const user = this.db.getUserByEmail(email);
                if (user && user.verificationCode === code) {
                    await this.db.updateUser(user.id, { 
                        emailVerified: true,
                        verificationCode: null
                    });
                    this.showNotification('Email verificado correctamente', 'success');
                    return true;
                } else {
                    this.showNotification('Código de verificación inválido', 'error');
                    return false;
                }
            }

            logout() {
                this.currentUser = null;
                localStorage.removeItem('servicepro_user');
                this.showLogin();
                this.showNotification('Sesión cerrada', 'success');
            }

            handleAuthSuccess() {
                this.hideLogin();
                this.updateUIForRole();
                
                if (this.currentUser.role === 'user') {
                    this.showUserInterface();
                } else {
                    this.showDashboard();
                }
            }

            showLogin() {
                document.getElementById('authButtons').style.display = 'flex';
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('heroSection').style.display = 'block';
                document.getElementById('features').style.display = 'block';
                document.getElementById('services').style.display = 'block';
                document.getElementById('stats').style.display = 'block';
                document.getElementById('cta').style.display = 'block';
                document.getElementById('footer').style.display = 'block';
            }

            hideLogin() {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('heroSection').style.display = 'none';
                document.getElementById('features').style.display = 'none';
                document.getElementById('services').style.display = 'none';
                document.getElementById('stats').style.display = 'none';
                document.getElementById('cta').style.display = 'none';
                document.getElementById('footer').style.display = 'none';
            }

            updateUIForRole() {
                document.getElementById('userEmail').textContent = this.currentUser.email;
                
                let roleText = '';
                switch(this.currentUser.role) {
                    case 'master': roleText = 'Master'; break;
                    case 'admin': roleText = 'Administrador'; break;
                    case 'employee': roleText = 'Empleado'; break;
                    default: roleText = 'Usuario';
                }
                document.getElementById('userRole').textContent = roleText;
                
                const adminToggle = document.getElementById('adminToggle');
                const newBookingBtn = document.getElementById('newBookingBtn');
                const servicesTabBtn = document.getElementById('servicesTabBtn');
                const usersTabBtn = document.getElementById('usersTabBtn');
                const masterConfigSection = document.getElementById('masterConfigSection');
                
                if (this.currentUser.role === 'user') {
                    adminToggle.classList.remove('visible');
                    newBookingBtn.style.display = 'block';
                    servicesTabBtn.style.display = 'none';
                    usersTabBtn.style.display = 'none';
                    masterConfigSection.style.display = 'none';
                } else {
                    adminToggle.classList.add('visible');
                    newBookingBtn.style.display = 'none';
                    servicesTabBtn.style.display = 'block';
                    usersTabBtn.style.display = 'block';
                    
                    if (this.currentUser.role === 'master') {
                        masterConfigSection.style.display = 'block';
                    } else {
                        masterConfigSection.style.display = 'none';
                    }
                }
            }

            showDashboard() {
                document.getElementById('dashboard').classList.add('active');
                if (window.dashboardManager) {
                    window.dashboardManager.loadDashboard();
                }
            }

            showUserInterface() {
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('newBookingBtn').style.display = 'block';
                // Ocultar pestañas de administración para usuarios normales
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.textContent.includes('Servicios') || btn.textContent.includes('Usuarios')) {
                        btn.style.display = 'none';
                    }
                });
                switchTab('calendar');
            }

            isMaster() {
                return this.currentUser && this.currentUser.role === 'master';
            }

            isAdmin() {
                return this.currentUser && (this.currentUser.role === 'admin' || this.currentUser.role === 'master');
            }

            isEmployee() {
                return this.currentUser && (this.currentUser.role === 'employee' || this.currentUser.role === 'admin' || this.currentUser.role === 'master');
            }

            isUser() {
                return this.currentUser && this.currentUser.role === 'user';
            }

            showVerificationModal(user) {
                // Implementar modal de verificación
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Verifica tu Email</h3>
                            <button class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Se ha enviado un código de verificación a ${user.email}. Ingresa el código a continuación:</p>
                            <div class="form-group">
                                <input type="text" class="form-control" id="verificationCode" placeholder="Código de verificación" maxlength="6">
                            </div>
                            <button class="btn btn-primary" onclick="verifyEmail('${user.email}')">Verificar</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                const messageEl = document.getElementById('notificationMessage');
                
                messageEl.textContent = message;
                notification.className = `notification ${type} active`;
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, 5000);
            }
        }

        // =============================================
        // SISTEMA DE SERVICIOS
        // =============================================
        class ServiceManager {
            constructor() {
                this.services = [];
                this.categories = {
                    appliance: { name: "Reparación de Electrodomésticos", icon: "fas fa-tools" },
                    handyman: { name: "Servicios de Handyman", icon: "fas fa-hammer" },
                    plumbing: { name: "Trabajos de Fontanería", icon: "fas fa-faucet" },
                    painting: { name: "Pintura", icon: "fas fa-paint-roller" },
                    flooring: { name: "Suelos", icon: "fas fa-border-all" },
                    carpentry: { name: "Carpintería Ligera", icon: "fas fa-tree" }
                };
                this.db = new Database();
                this.loadServices();
            }

            async loadServices() {
                await this.db.init();
                this.services = this.db.getServices();
                this.renderServices();
                this.renderServiceOptions();
            }

            renderServices() {
                const grid = document.getElementById('servicesGrid');
                if (!grid) return;
                
                grid.innerHTML = '';

                this.services.filter(service => service.status === 'active').forEach(service => {
                    const serviceCard = this.createServiceCard(service);
                    grid.appendChild(serviceCard);
                });
            }

            createServiceCard(service) {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.innerHTML = `
                    <div class="service-image" style="${service.image ? `background-image: url('${service.image}')` : `background: var(--primary)`}">
                        ${!service.image ? `<i class="${service.icon}"></i>` : ''}
                    </div>
                    <div class="service-info">
                        <div class="service-title">${service.name}</div>
                        <div class="service-description">${service.description}</div>
                        <ul class="service-features">
                            ${service.features.slice(0, 3).map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
                        </ul>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div style="font-weight: bold; color: var(--primary);">$${service.price.toFixed(2)}</div>
                            <button class="btn btn-primary" onclick="startBooking(${service.id})">
                                <i class="fas fa-calendar-plus"></i> Reservar
                            </button>
                        </div>
                    </div>
                `;
                return card;
            }

            renderServiceOptions() {
                const options = document.getElementById('serviceOptions');
                if (!options) return;
                
                options.innerHTML = '';

                this.services.filter(service => service.status === 'active').forEach(service => {
                    const option = document.createElement('div');
                    option.className = 'service-option';
                    option.onclick = () => selectService(service.id);
                    option.innerHTML = `
                        <div class="service-option-icon">
                            <i class="${service.icon}"></i>
                        </div>
                        <div class="service-option-name">${service.name}</div>
                        <div class="service-option-price">$${service.price.toFixed(2)}</div>
                    `;
                    options.appendChild(option);
                });
            }

            getServiceById(id) {
                return this.services.find(service => service.id === id) || null;
            }

            async createService(serviceData) {
                if (!window.authManager.isAdmin()) {
                    window.authManager.showNotification('No tienes permisos para crear servicios', 'error');
                    return false;
                }

                const service = await this.db.createService(serviceData);
                if (service) {
                    this.loadServices();
                    window.authManager.showNotification('Servicio creado exitosamente', 'success');
                    return true;
                }
                return false;
            }

            async updateService(id, updates) {
                if (!window.authManager.isAdmin()) {
                    window.authManager.showNotification('No tienes permisos para actualizar servicios', 'error');
                    return false;
                }

                const success = await this.db.updateService(id, updates);
                if (success) {
                    this.loadServices();
                    window.authManager.showNotification('Servicio actualizado exitosamente', 'success');
                    return true;
                }
                return false;
            }

            async deleteService(id) {
                if (!window.authManager.isAdmin()) {
                    window.authManager.showNotification('No tienes permisos para eliminar servicios', 'error');
                    return false;
                }

                const success = await this.db.deleteService(id);
                if (success) {
                    this.loadServices();
                    window.authManager.showNotification('Servicio eliminado exitosamente', 'success');
                    return true;
                }
                return false;
            }
        }

        // =============================================
        // SISTEMA DE DASHBOARD
        // =============================================
        class DashboardManager {
            constructor() {
                this.currentDate = new Date();
                this.currentMonth = this.currentDate.getMonth();
                this.currentYear = this.currentDate.getFullYear();
                this.bookings = [];
                this.db = new Database();
                this.loadBookings();
            }

            async loadBookings() {
                await this.db.init();
                this.bookings = this.db.getBookings();
                this.updateStats();
                this.renderCalendar();
                this.renderBookingsTable();
                this.renderCustomersTable();
                this.renderServicesTable();
                this.renderUsersTable();
            }

            updateStats() {
                document.getElementById('totalBookings').textContent = this.bookings.length;
                document.getElementById('confirmedBookings').textContent = this.bookings.filter(b => b.status === 'confirmed').length;
                document.getElementById('pendingBookings').textContent = this.bookings.filter(b => b.status === 'pending').length;
                document.getElementById('cancelledBookings').textContent = this.bookings.filter(b => b.status === 'cancelled').length;
            }

            renderCalendar() {
                const calendarGrid = document.getElementById('calendarGrid');
                const currentMonthElement = document.getElementById('currentMonth');
                
                if (!calendarGrid) return;
                
                // Actualizar el mes actual
                const monthNames = [
                    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
                ];
                
                if (window.i18nManager && window.i18nManager.currentLanguage === 'en') {
                    const monthNamesEn = [
                        "January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"
                    ];
                    currentMonthElement.textContent = `${monthNamesEn[this.currentMonth]} ${this.currentYear}`;
                } else {
                    currentMonthElement.textContent = `${monthNames[this.currentMonth]} ${this.currentYear}`;
                }
                
                // Limpiar el calendario
                calendarGrid.innerHTML = '';
                
                // Agregar encabezados de días
                const dayNames = (window.i18nManager && window.i18nManager.currentLanguage === 'en') ? 
                    ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'] :
                    ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
                
                dayNames.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });
                
                // Obtener el primer día del mes y el número de días
                const firstDay = new Date(this.currentYear, this.currentMonth, 1).getDay();
                const daysInMonth = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
                
                // Agregar días vacíos para alinear el primer día
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    calendarGrid.appendChild(emptyDay);
                }
                
                // Agregar los días del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    // Verificar si es hoy
                    const today = new Date();
                    if (day === today.getDate() && this.currentMonth === today.getMonth() && this.currentYear === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    dayElement.innerHTML = `<div class="calendar-day-header">${day}</div>`;
                    
                    // Agregar eventos para este día
                    const dayBookings = this.bookings.filter(booking => {
                        const bookingDate = new Date(booking.date);
                        return bookingDate.getDate() === day && 
                               bookingDate.getMonth() === this.currentMonth && 
                               bookingDate.getFullYear() === this.currentYear;
                    });
                    
                    dayBookings.forEach(booking => {
                        const service = window.serviceManager.getServiceById(booking.serviceId);
                        const eventElement = document.createElement('div');
                        eventElement.className = 'calendar-event';
                        eventElement.textContent = `${booking.customerName} - ${service ? service.name : 'N/A'}`;
                        eventElement.onclick = () => this.viewBookingDetails(booking.id);
                        dayElement.appendChild(eventElement);
                    });
                    
                    calendarGrid.appendChild(dayElement);
                }
            }

            changeMonth(direction) {
                this.currentMonth += direction;
                
                if (this.currentMonth > 11) {
                    this.currentMonth = 0;
                    this.currentYear++;
                } else if (this.currentMonth < 0) {
                    this.currentMonth = 11;
                    this.currentYear--;
                }
                
                this.renderCalendar();
            }

            renderBookingsTable() {
                const table = document.getElementById('bookingsTable');
                if (!table) return;
                
                table.innerHTML = '';
                
                // Ordenar reservas por fecha (más recientes primero)
                const sortedBookings = [...this.bookings].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                sortedBookings.forEach(booking => {
                    const service = window.serviceManager.getServiceById(booking.serviceId);
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(booking.status) {
                        case 'pending':
                            statusClass = 'status-pending';
                            statusText = 'Pendiente';
                            break;
                        case 'confirmed':
                            statusClass = 'status-confirmed';
                            statusText = 'Confirmada';
                            break;
                        case 'completed':
                            statusClass = 'status-completed';
                            statusText = 'Completada';
                            break;
                        case 'cancelled':
                            statusClass = 'status-cancelled';
                            statusText = 'Cancelada';
                            break;
                    }
                    
                    row.innerHTML = `
                        <td>#${booking.id}</td>
                        <td>${booking.customerName}</td>
                        <td>${service ? service.name : 'N/A'}</td>
                        <td>${new Date(booking.date).toLocaleDateString()}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn view" onclick="dashboardManager.viewBookingDetails(${booking.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="dashboardManager.editBooking(${booking.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="dashboardManager.deleteBooking(${booking.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }

            renderCustomersTable() {
                const table = document.getElementById('customersTable');
                if (!table) return;
                
                const customers = this.db.data.customers;
                table.innerHTML = '';
                
                customers.forEach(customer => {
                    const customerBookings = this.bookings.filter(b => b.customerEmail === customer.email);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone || 'N/A'}</td>
                        <td>${customerBookings.length}</td>
                        <td class="action-buttons">
                            <button class="action-btn view" onclick="dashboardManager.viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="dashboardManager.contactCustomer(${customer.id})">
                                <i class="fas fa-phone"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }

            renderServicesTable() {
                const table = document.getElementById('servicesTable');
                if (!table) return;
                
                table.innerHTML = '';
                
                window.serviceManager.services.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${service.name}</td>
                        <td>${window.serviceManager.categories[service.category].name}</td>
                        <td>$${service.price.toFixed(2)}</td>
                        <td>${service.duration} min</td>
                        <td class="action-buttons">
                            <button class="action-btn edit" onclick="dashboardManager.editService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="dashboardManager.deleteService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }

            renderUsersTable() {
                const table = document.getElementById('usersTable');
                if (!table) return;
                
                table.innerHTML = '';
                
                this.db.getUsers().forEach(user => {
                    const row = document.createElement('tr');
                    let roleText = '';
                    switch(user.role) {
                        case 'master': roleText = 'Master'; break;
                        case 'admin': roleText = 'Administrador'; break;
                        case 'employee': roleText = 'Empleado'; break;
                        default: roleText = 'Usuario';
                    }
                    
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${roleText}</td>
                        <td><span class="status-badge ${user.status === 'active' ? 'status-confirmed' : 'status-cancelled'}">${user.status === 'active' ? 'Activo' : 'Inactivo'}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn edit" onclick="dashboardManager.editUser(${user.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="dashboardManager.deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }

            viewBookingDetails(bookingId) {
                const booking = this.bookings.find(b => b.id === bookingId);
                if (booking) {
                    const service = window.serviceManager.getServiceById(booking.serviceId);
                    alert(`Detalles de la Reserva #${bookingId}\n\nCliente: ${booking.customerName}\nServicio: ${service.name}\nFecha: ${new Date(booking.date).toLocaleString()}\nEstado: ${booking.status}\nProblema: ${booking.problemDescription}`);
                }
            }

            editBooking(bookingId) {
                // Implementar edición de reserva
                alert(`Editando reserva ${bookingId}`);
            }

            async deleteBooking(bookingId) {
                if (confirm('¿Estás seguro de que quieres eliminar esta reserva?')) {
                    const success = await this.db.updateBooking(bookingId, { status: 'cancelled' });
                    if (success) {
                        this.loadBookings();
                        window.authManager.showNotification('Reserva cancelada', 'success');
                    }
                }
            }

            viewCustomer(customerId) {
                const customer = this.db.data.customers.find(c => c.id === customerId);
                if (customer) {
                    const customerBookings = this.bookings.filter(b => b.customerEmail === customer.email);
                    alert(`Detalles del Cliente\n\nNombre: ${customer.name}\nEmail: ${customer.email}\nTeléfono: ${customer.phone}\nDirección: ${customer.address}\nTotal de Reservas: ${customerBookings.length}`);
                }
            }

            contactCustomer(customerId) {
                const customer = this.db.data.customers.find(c => c.id === customerId);
                if (customer) {
                    startCall(customer.name, 'customer');
                }
            }

            editService(serviceId) {
                showServiceEditor(serviceId);
            }

            async deleteService(serviceId) {
                if (confirm('¿Estás seguro de que quieres eliminar este servicio?')) {
                    const success = await window.serviceManager.deleteService(serviceId);
                    if (success) {
                        this.loadBookings();
                    }
                }
            }

            editUser(userId) {
                showUserEditor(userId);
            }

            async deleteUser(userId) {
                if (confirm('¿Estás seguro de que quieres eliminar este usuario?')) {
                    const success = await this.db.deleteUser(userId);
                    if (success) {
                        this.loadBookings();
                        window.authManager.showNotification('Usuario eliminado', 'success');
                    }
                }
            }

            loadDashboard() {
                this.loadBookings();
                this.updateStats();
            }
        }

        // =============================================
        // SISTEMA DE RESERVAS
        // =============================================
        class BookingManager {
            constructor() {
                this.currentStep = 1;
                this.selectedService = null;
                this.bookingData = {};
                this.db = new Database();
            }

            startBooking(serviceId) {
                if (!window.authManager.currentUser) {
                    window.authManager.showNotification('Por favor inicia sesión para reservar un servicio', 'warning');
                    showLoginModal();
                    return;
                }

                this.selectedService = window.serviceManager.getServiceById(serviceId);
                this.bookingData.serviceId = serviceId;
                this.showBookingModal();
                this.updateStep(1);
            }

            showBookingModal() {
                document.getElementById('bookingModal').classList.add('active');
                this.updateStep(1);
            }

            closeBookingModal() {
                document.getElementById('bookingModal').classList.remove('active');
                this.resetBooking();
            }

            resetBooking() {
                this.currentStep = 1;
                this.selectedService = null;
                this.bookingData = {};
                this.updateStep(1);
                document.getElementById('imagePreview').innerHTML = '';
                document.getElementById('problemDescription').value = '';
                document.getElementById('preferredDate').value = '';
                document.getElementById('preferredTime').value = '09:00';
                document.getElementById('serviceAddress').value = '';
                document.getElementById('termsAgreement').checked = false;
            }

            updateStep(step) {
                // Actualizar indicadores de pasos
                document.querySelectorAll('.booking-step').forEach((stepEl, index) => {
                    stepEl.classList.remove('active', 'completed');
                    if (index + 1 === step) {
                        stepEl.classList.add('active');
                    } else if (index + 1 < step) {
                        stepEl.classList.add('completed');
                    }
                });

                // Ocultar todos los pasos
                document.querySelectorAll('.booking-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Mostrar el paso actual
                document.getElementById(`step${step}`).classList.add('active');

                // Actualizar botones de navegación
                document.getElementById('prevBtn').style.display = step > 1 ? 'inline-block' : 'none';

                if (step === 4) {
                    document.getElementById('nextBtn').innerHTML = `<i class="fas fa-check"></i> Confirmar`;
                    document.getElementById('nextBtn').onclick = () => this.confirmBooking();
                    this.updateSummary();
                } else {
                    document.getElementById('nextBtn').innerHTML = `Siguiente <i class="fas fa-arrow-right"></i>`;
                    document.getElementById('nextBtn').onclick = () => this.nextStep();
                }

                this.currentStep = step;
            }

            nextStep() {
                if (this.validateStep(this.currentStep)) {
                    this.updateStep(this.currentStep + 1);
                }
            }

            prevStep() {
                this.updateStep(this.currentStep - 1);
            }

            validateStep(step) {
                switch(step) {
                    case 1:
                        if (!this.selectedService) {
                            window.authManager.showNotification('Por favor selecciona un servicio', 'warning');
                            return false;
                        }
                        document.getElementById('selectedServiceName').textContent = this.selectedService.name;
                        break;
                    case 2:
                        const problemDescription = document.getElementById('problemDescription').value;
                        if (!problemDescription.trim()) {
                            window.authManager.showNotification('Por favor describe el problema', 'warning');
                            return false;
                        }
                        this.bookingData.problemDescription = problemDescription;
                        break;
                    case 3:
                        const date = document.getElementById('preferredDate').value;
                        const time = document.getElementById('preferredTime').value;
                        const address = document.getElementById('serviceAddress').value;
                        
                        if (!date) {
                            window.authManager.showNotification('Por favor selecciona una fecha', 'warning');
                            return false;
                        }
                        
                        if (!address.trim()) {
                            window.authManager.showNotification('Por favor ingresa la dirección del servicio', 'warning');
                            return false;
                        }
                        
                        this.bookingData.date = `${date}T${time}:00`;
                        this.bookingData.customerAddress = address;
                        break;
                }
                return true;
            }

            updateSummary() {
                document.getElementById('summaryService').textContent = this.selectedService.name;
                document.getElementById('summaryDate').textContent = new Date(this.bookingData.date).toLocaleDateString();
                document.getElementById('summaryTime').textContent = new Date(this.bookingData.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                document.getElementById('summaryAddress').textContent = this.bookingData.customerAddress;
                document.getElementById('summaryProblem').textContent = this.bookingData.problemDescription;
            }

            async confirmBooking() {
                if (!document.getElementById('termsAgreement').checked) {
                    window.authManager.showNotification('Por favor acepta los términos y condiciones', 'warning');
                    return;
                }

                // Completar datos de la reserva
                this.bookingData.customerName = window.authManager.currentUser.name;
                this.bookingData.customerEmail = window.authManager.currentUser.email;
                this.bookingData.customerPhone = window.authManager.currentUser.phone;
                this.bookingData.servicePrice = this.selectedService.price;

                const success = await this.db.createBooking(this.bookingData);
                
                if (success) {
                    window.authManager.showNotification('Reserva creada exitosamente. Te hemos enviado un email de confirmación.', 'success');
                    this.closeBookingModal();
                    
                    if (window.dashboardManager) {
                        window.dashboardManager.loadDashboard();
                    }
                } else {
                    window.authManager.showNotification('Error al crear la reserva', 'error');
                }
            }
        }

        // =============================================
        // SISTEMA DE COMUNICACIONES VOIP
        // =============================================
        class VoipManager {
            constructor() {
                this.currentCall = null;
                this.twilioClient = null;
                this.init();
            }

            async init() {
                // Cargar configuración de Twilio
                const config = window.db.getConfig();
                if (config.voip_twilio_sid && config.voip_twilio_token) {
                    await this.loadTwilioClient(config);
                }
            }

            async loadTwilioClient(config) {
                // Cargar SDK de Twilio
                if (!window.Twilio) {
                    const script = document.createElement('script');
                    script.src = 'https://sdk.twilio.com/js/video/releases/2.3.0/twilio-video.min.js';
                    document.head.appendChild(script);
                }

                // Inicializar cliente de Twilio
                try {
                    // Esta es una implementación simplificada
                    // En producción, se necesitaría un servidor para generar tokens
                    console.log('Twilio configurado con SID:', config.voip_twilio_sid);
                } catch (error) {
                    console.error('Error inicializando Twilio:', error);
                }
            }

            startCall(contactName, contactType) {
                document.getElementById('callControls').style.display = 'flex';
                this.currentCall = {
                    contactName: contactName,
                    contactType: contactType,
                    startTime: new Date()
                };
                
                window.authManager.showNotification(`Llamando a ${contactName}...`, 'success');
            }

            makeCall() {
                if (this.currentCall) {
                    // Implementar llamada real con Twilio
                    window.authManager.showNotification(`Llamada en curso con ${this.currentCall.contactName}`, 'success');
                }
            }

            sendMessage() {
                if (this.currentCall) {
                    const message = prompt(`Enviar mensaje a ${this.currentCall.contactName}:`);
                    if (message) {
                        // Implementar envío de SMS con Twilio
                        window.authManager.showNotification(`Mensaje enviado a ${this.currentCall.contactName}`, 'success');
                    }
                }
            }

            endCall() {
                if (this.currentCall) {
                    const duration = Math.round((new Date() - this.currentCall.startTime) / 1000);
                    window.authManager.showNotification(`Llamada finalizada. Duración: ${duration} segundos`, 'success');
                    this.currentCall = null;
                    document.getElementById('callControls').style.display = 'none';
                }
            }
        }

        // =============================================
        // SISTEMA DE INTERNACIONALIZACIÓN
        // =============================================
        class I18nManager {
            constructor() {
                this.currentLanguage = 'es';
                this.translations = {
                    es: {
                        // Navegación
                        services: "Servicios",
                        features: "Características",
                        about: "Nosotros",
                        contact: "Contacto",
                        login: "Iniciar Sesión",
                        register: "Registrarse",
                        logout: "Cerrar Sesión",

                        // Hero Section
                        heroTitle: "Servicios Profesionales para tu Hogar",
                        heroSubtitle: "Reserva fácilmente servicios de reparación, mantenimiento e instalación con profesionales certificados",
                        bookNow: "Reservar Ahora",
                        viewServices: "Ver Servicios",

                        // Features
                        whyChooseUs: "¿Por Qué Elegirnos?",
                        fastService: "Servicio Rápido",
                        fastServiceDesc: "Respuesta inmediata y servicio eficiente",
                        qualityGuarantee: "Garantía de Calidad",
                        qualityGuaranteeDesc: "Todos nuestros servicios incluyen garantía",
                        expertTechnicians: "Técnicos Expertos",
                        expertTechniciansDesc: "Profesionales certificados con experiencia",

                        // Services
                        ourServices: "Nuestros Servicios",

                        // Stats
                        jobsCompleted: "Trabajos Completados",
                        happyClients: "Clientes Satisfechos",
                        expertTechnicians: "Técnicos Expertos",
                        serviceAreas: "Áreas de Servicio",

                        // CTA
                        readyToGetStarted: "¿Listo para comenzar?",
                        ctaDescription: "Únete a miles de clientes satisfechos",
                        getStarted: "Comenzar Ahora",

                        // Footer
                        servicePro: "ServicePro",
                        footerDescription: "Tu socio confiable para servicios del hogar",
                        quickLinks: "Enlaces Rápidos",
                        contactUs: "Contáctanos",
                        address: "123 Calle Principal, Ciudad",
                        allRightsReserved: "Todos los derechos reservados",

                        // Auth
                        createAccount: "Crear Cuenta",
                        fullName: "Nombre Completo",
                        email: "Correo Electrónico",
                        phone: "Teléfono",
                        password: "Contraseña",
                        confirmPassword: "Confirmar Contraseña",
                        haveAccount: "¿Ya tienes cuenta?",
                        loginHere: "Inicia sesión aquí",
                        noAccount: "¿No tienes cuenta?",
                        registerHere: "Regístrate aquí",
                        or: "O",
                        enterEmail: "Ingresa tu email",
                        enterPassword: "Ingresa tu contraseña",
                        enterFullName: "Ingresa tu nombre completo",
                        enterPhone: "Ingresa tu teléfono",

                        // Dashboard
                        dashboard: "Panel de Control",
                        newBooking: "Nueva Reserva",
                        totalBookings: "Total Reservas",
                        confirmed: "Confirmadas",
                        pending: "Pendientes",
                        cancelled: "Canceladas",
                        calendar: "Calendario",
                        bookings: "Reservas",
                        customers: "Clientes",
                        users: "Usuarios",
                        recentBookings: "Reservas Recientes",
                        id: "ID",
                        customer: "Cliente",
                        service: "Servicio",
                        date: "Fecha",
                        status: "Estado",
                        actions: "Acciones",
                        name: "Nombre",
                        bookings: "Reservas",
                        servicesManagement: "Gestión de Servicios",
                        addService: "Agregar Servicio",
                        category: "Categoría",
                        price: "Precio",
                        duration: "Duración",
                        userManagement: "Gestión de Usuarios",
                        addUser: "Agregar Usuario",
                        role: "Rol",

                        // Booking
                        bookService: "Reservar Servicio",
                        selectService: "Selecciona un Servicio",
                        serviceDetails: "Detalles del Servicio",
                        selectedService: "Servicio Seleccionado",
                        problemDescription: "Descripción del Problema",
                        describeProblem: "Describe el problema o servicio que necesitas",
                        uploadPhotos: "Subir Fotos (Opcional)",
                        uploadHint: "Haz clic para subir fotos o arrástralas aquí",
                        scheduleAppointment: "Programar Cita",
                        preferredDate: "Fecha Preferida",
                        preferredTime: "Hora Preferida",
                        serviceAddress: "Dirección del Servicio",
                        enterServiceAddress: "Ingresa la dirección donde se realizará el servicio",
                        confirmation: "Confirmación",
                        bookingSummary: "Resumen de la Reserva",
                        time: "Hora",
                        address: "Dirección",
                        problem: "Problema",
                        agreeTerms: "Acepto los términos y condiciones del servicio",
                        previous: "Anterior",
                        next: "Siguiente",

                        // Admin
                        systemConfig: "Configuración del Sistema",
                        companyName: "Nombre de la Empresa",
                        primaryColor: "Color Primario",
                        secondaryColor: "Color Secundario",
                        saveConfig: "Guardar Configuración",
                        voipConfig: "Configuración VOIP",
                        dataStorage: "Almacenamiento de Datos",
                        localStorageDesc: "Almacenamiento local en el navegador",
                        apiStorageDesc: "Conexión con servidor externo",

                        // Communications
                        communications: "Comunicaciones",
                        technician: "Técnico",

                        // Service Editor
                        addService: "Agregar Servicio",
                        serviceName: "Nombre del Servicio",
                        description: "Descripción",
                        serviceIcon: "Icono del Servicio",
                        serviceImage: "Imagen del Servicio",
                        uploadImageHint: "Haz clic para subir una imagen",
                        features: "Características",
                        addFeature: "Agregar Característica",
                        saveService: "Guardar Servicio",
                        applianceRepair: "Reparación de Electrodomésticos",
                        handymanServices: "Servicios de Handyman",
                        plumbing: "Fontanería",
                        painting: "Pintura",
                        flooring: "Suelos",
                        carpentry: "Carpintería",

                        // User Editor
                        addUser: "Agregar Usuario",
                        saveUser: "Guardar Usuario",
                        master: "Master"
                    },
                    en: {
                        // Navigation
                        services: "Services",
                        features: "Features",
                        about: "About",
                        contact: "Contact",
                        login: "Login",
                        register: "Register",
                        logout: "Logout",

                        // Hero Section
                        heroTitle: "Professional Services for Your Home",
                        heroSubtitle: "Easily book repair, maintenance and installation services",
                        bookNow: "Book Now",
                        viewServices: "View Services",

                        // Features
                        whyChooseUs: "Why Choose Us?",
                        fastService: "Fast Service",
                        fastServiceDesc: "Immediate response and efficient service",
                        qualityGuarantee: "Quality Guarantee",
                        qualityGuaranteeDesc: "All our services include warranty",
                        expertTechnicians: "Expert Technicians",
                        expertTechniciansDesc: "Certified professionals with experience",

                        // Services
                        ourServices: "Our Services",

                        // Stats
                        jobsCompleted: "Jobs Completed",
                        happyClients: "Happy Clients",
                        expertTechnicians: "Expert Technicians",
                        serviceAreas: "Service Areas",

                        // CTA
                        readyToGetStarted: "Ready to Get Started?",
                        ctaDescription: "Join thousands of satisfied customers",
                        getStarted: "Get Started",

                        // Footer
                        servicePro: "ServicePro",
                        footerDescription: "Your reliable partner for home services",
                        quickLinks: "Quick Links",
                        contactUs: "Contact Us",
                        address: "123 Main Street, City",
                        allRightsReserved: "All rights reserved",

                        // Auth
                        createAccount: "Create Account",
                        fullName: "Full Name",
                        email: "Email",
                        phone: "Phone",
                        password: "Password",
                        confirmPassword: "Confirm Password",
                        haveAccount: "Already have an account?",
                        loginHere: "Login here",
                        noAccount: "Don't have an account?",
                        registerHere: "Register here",
                        or: "Or",
                        enterEmail: "Enter your email",
                        enterPassword: "Enter your password",
                        enterFullName: "Enter your full name",
                        enterPhone: "Enter your phone",

                        // Dashboard
                        dashboard: "Dashboard",
                        newBooking: "New Booking",
                        totalBookings: "Total Bookings",
                        confirmed: "Confirmed",
                        pending: "Pending",
                        cancelled: "Cancelled",
                        calendar: "Calendar",
                        bookings: "Bookings",
                        customers: "Customers",
                        users: "Users",
                        recentBookings: "Recent Bookings",
                        id: "ID",
                        customer: "Customer",
                        service: "Service",
                        date: "Date",
                        status: "Status",
                        actions: "Actions",
                        name: "Name",
                        bookings: "Bookings",
                        servicesManagement: "Services Management",
                        addService: "Add Service",
                        category: "Category",
                        price: "Price",
                        duration: "Duration",
                        userManagement: "User Management",
                        addUser: "Add User",
                        role: "Role",

                        // Booking
                        bookService: "Book Service",
                        selectService: "Select a Service",
                        serviceDetails: "Service Details",
                        selectedService: "Selected Service",
                        problemDescription: "Problem Description",
                        describeProblem: "Describe the problem or service you need",
                        uploadPhotos: "Upload Photos (Optional)",
                        uploadHint: "Click to upload photos or drag them here",
                        scheduleAppointment: "Schedule Appointment",
                        preferredDate: "Preferred Date",
                        preferredTime: "Preferred Time",
                        serviceAddress: "Service Address",
                        enterServiceAddress: "Enter the address where service will be performed",
                        confirmation: "Confirmation",
                        bookingSummary: "Booking Summary",
                        time: "Time",
                        address: "Address",
                        problem: "Problem",
                        agreeTerms: "I agree to the terms and conditions",
                        previous: "Previous",
                        next: "Next",

                        // Admin
                        systemConfig: "System Configuration",
                        companyName: "Company Name",
                        primaryColor: "Primary Color",
                        secondaryColor: "Secondary Color",
                        saveConfig: "Save Configuration",
                        voipConfig: "VOIP Configuration",
                        dataStorage: "Data Storage",
                        localStorageDesc: "Local storage in browser",
                        apiStorageDesc: "Connection with external server",

                        // Communications
                        communications: "Communications",
                        technician: "Technician",

                        // Service Editor
                        addService: "Add Service",
                        serviceName: "Service Name",
                        description: "Description",
                        serviceIcon: "Service Icon",
                        serviceImage: "Service Image",
                        uploadImageHint: "Click to upload an image",
                        features: "Features",
                        addFeature: "Add Feature",
                        saveService: "Save Service",
                        applianceRepair: "Appliance Repair",
                        handymanServices: "Handyman Services",
                        plumbing: "Plumbing",
                        painting: "Painting",
                        flooring: "Flooring",
                        carpentry: "Carpentry",

                        // User Editor
                        addUser: "Add User",
                        saveUser: "Save User",
                        master: "Master"
                    }
                };
                this.loadLanguage();
            }

            loadLanguage() {
                const config = window.db.getConfig();
                this.currentLanguage = config.language || 'es';
                this.applyTranslations();
            }

            changeLanguage(lang) {
                this.currentLanguage = lang;
                window.db.updateConfig('language', lang);
                this.applyTranslations();
                
                if (window.dashboardManager) {
                    window.dashboardManager.renderCalendar();
                }
            }

            translate(key) {
                return this.translations[this.currentLanguage][key] || key;
            }

            applyTranslations() {
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    element.textContent = this.translate(key);
                });

                const placeholders = document.querySelectorAll('[data-i18n-placeholder]');
                placeholders.forEach(element => {
                    const key = element.getAttribute('data-i18n-placeholder');
                    element.placeholder = this.translate(key);
                });
            }
        }

        // =============================================
        // FUNCIONES GLOBALES
        // =============================================

        // Instancias globales
        let db, authManager, serviceManager, dashboardManager, bookingManager, voipManager, i18nManager;

        // Inicialización
        document.addEventListener('DOMContentLoaded', async () => {
            // Inicializar sistemas
            db = new Database();
            await db.init();
            
            i18nManager = new I18nManager();
            authManager = new AuthManager();
            serviceManager = new ServiceManager();
            dashboardManager = new DashboardManager();
            bookingManager = new BookingManager();
            voipManager = new VoipManager();

            // Configurar Google Sign-In
            initializeGoogleSignIn();

            // Configurar fecha mínima para reservas
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('preferredDate').min = today;
        });

        function initializeGoogleSignIn() {
            google.accounts.id.initialize({
                client_id: 'TU_CLIENT_ID_GOOGLE', // Reemplazar con Client ID real
                callback: handleGoogleSignIn
            });

            google.accounts.id.renderButton(
                document.getElementById('google-auth-container'),
                { theme: 'outline', size: 'large', width: '100%' }
            );

            google.accounts.id.renderButton(
                document.getElementById('google-register-container'),
                { theme: 'outline', size: 'large', width: '100%' }
            );
        }

        function handleGoogleSignIn(response) {
            authManager.loginWithGoogle(response);
        }

        // Navegación
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Modales
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function showRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').classList.remove('active');
        }

        // Autenticación
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            authManager.login(email, password);
        }

        function register() {
            const userData = {
                name: document.getElementById('registerName').value,
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                phone: document.getElementById('registerPhone').value
            };
            authManager.register(userData);
        }

        function logout() {
            authManager.logout();
        }

        function verifyEmail(email, code) {
            const verificationCode = document.getElementById('verificationCode').value;
            authManager.verifyEmail(email, verificationCode);
        }

        // Reservas
        function startBooking(serviceId) {
            bookingManager.startBooking(serviceId);
        }

        function closeBookingModal() {
            bookingManager.closeBookingModal();
        }

        function selectService(serviceId) {
            bookingManager.selectedService = serviceManager.getServiceById(serviceId);
            bookingManager.bookingData.serviceId = serviceId;
            document.getElementById('selectedServiceName').textContent = bookingManager.selectedService.name;
            
            // Marcar como seleccionado
            document.querySelectorAll('.service-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            bookingManager.nextStep();
        }

        function nextBookingStep() {
            bookingManager.nextStep();
        }

        function prevBookingStep() {
            bookingManager.prevStep();
        }

        // Gestión de imágenes
        function handleImageUpload(input) {
            const files = input.files;
            const preview = document.getElementById('imagePreview');
            
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button type="button" class="remove-image" onclick="this.parentElement.remove()">&times;</button>
                        `;
                        preview.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        function handleServiceImageUpload(input) {
            const file = input.files[0];
            const preview = document.getElementById('serviceImagePreview');
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div class="preview-item">
                            <img src="${e.target.result}" alt="Service Preview">
                            <button type="button" class="remove-image" onclick="this.parentElement.remove()">&times;</button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Dashboard
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        function changeMonth(direction) {
            dashboardManager.changeMonth(direction);
        }

        // VOIP
        function toggleVoip() {
            document.getElementById('voipPanel').classList.toggle('active');
        }

        function startCall(contactName, contactType) {
            voipManager.startCall(contactName, contactType);
        }

        function makeCall() {
            voipManager.makeCall();
        }

        function sendMessage() {
            voipManager.sendMessage();
        }

        function endCall() {
            voipManager.endCall();
        }

        // Administración
        function toggleAdminPanel() {
            document.getElementById('adminPanel').classList.toggle('active');
        }

        function toggleLanguageDropdown() {
            document.getElementById('languageDropdown').classList.toggle('active');
        }

        function changeLanguage(lang) {
            i18nManager.changeLanguage(lang);
            document.getElementById('currentLanguage').textContent = lang.toUpperCase();
            document.getElementById('languageDropdown').classList.remove('active');
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            db.updateConfig('theme', newTheme);
            
            const themeIcon = document.getElementById('themeToggle').querySelector('i');
            themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function saveSystemConfig() {
            // Implementar guardado de configuración del sistema
            authManager.showNotification('Configuración guardada', 'success');
        }

        function saveVoipConfig() {
            // Implementar guardado de configuración VOIP
            authManager.showNotification('Configuración VOIP guardada', 'success');
        }

        // Almacenamiento de datos
        function selectStorage(type) {
            document.querySelectorAll('.storage-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            document.getElementById('apiConfig').style.display = type === 'api' ? 'block' : 'none';
            document.getElementById('d1Config').style.display = type === 'd1' ? 'block' : 'none';
        }

        function saveStorageConfig() {
            // Implementar guardado de configuración de almacenamiento
            authManager.showNotification('Configuración de almacenamiento guardada', 'success');
        }

        // Editores
        function showServiceEditor(serviceId = null) {
            const modal = document.getElementById('serviceEditorModal');
            const title = document.getElementById('serviceEditorTitle');
            
            if (serviceId) {
                title.textContent = 'Editar Servicio';
                const service = serviceManager.getServiceById(serviceId);
                // Llenar formulario con datos del servicio
            } else {
                title.textContent = 'Agregar Servicio';
                // Limpiar formulario
            }
            
            modal.classList.add('active');
        }

        function closeServiceEditor() {
            document.getElementById('serviceEditorModal').classList.remove('active');
        }

        function addFeatureField() {
            const featuresContainer = document.getElementById('serviceFeatures');
            const featureCount = featuresContainer.children.length + 1;
            const newFeature = document.createElement('div');
            newFeature.className = 'form-group';
            newFeature.style.marginBottom = '10px';
            newFeature.innerHTML = `<input type="text" class="form-control" placeholder="Característica ${featureCount}">`;
            featuresContainer.appendChild(newFeature);
        }

        function showUserEditor(userId = null) {
            const modal = document.getElementById('userEditorModal');
            const title = document.getElementById('userEditorTitle');
            
            if (userId) {
                title.textContent = 'Editar Usuario';
                const user = db.getUserById(userId);
                // Llenar formulario con datos del usuario
            } else {
                title.textContent = 'Agregar Usuario';
                // Limpiar formulario
            }
            
            modal.classList.add('active');
        }

        function closeUserEditor() {
            document.getElementById('userEditorModal').classList.remove('active');
        }

        // Manejo de formularios
        document.getElementById('loginForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            login();
        });

        document.getElementById('registerForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            register();
        });

        document.getElementById('serviceForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            // Implementar guardado de servicio
            const serviceData = {
                name: document.getElementById('serviceName').value,
                category: document.getElementById('serviceCategory').value,
                description: document.getElementById('serviceDescription').value,
                price: parseFloat(document.getElementById('servicePrice').value),
                duration: parseInt(document.getElementById('serviceDuration').value),
                icon: document.getElementById('serviceIcon').value,
                features: Array.from(document.querySelectorAll('#serviceFeatures input')).map(input => input.value).filter(val => val)
            };
            serviceManager.createService(serviceData);
            closeServiceEditor();
        });

        document.getElementById('userForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            // Implementar guardado de usuario
            closeUserEditor();
        });
    </script>
</body>
</html>
